VERSION 5.00
Object = "{F9043C88-F6F2-101A-A3C9-08002B2F49FB}#1.2#0"; "COMDLG32.OCX"
Begin VB.Form frmExMasterInput 
   BorderStyle     =   0  'なし
   Caption         =   "外部マスタ入力画面"
   ClientHeight    =   9000
   ClientLeft      =   2175
   ClientTop       =   2430
   ClientWidth     =   12000
   ControlBox      =   0   'False
   LinkTopic       =   "Form1"
   MaxButton       =   0   'False
   MinButton       =   0   'False
   Moveable        =   0   'False
   NegotiateMenus  =   0   'False
   PaletteMode     =   1  'Z ｵｰﾀﾞｰ
   ScaleHeight     =   9000
   ScaleWidth      =   12000
   ShowInTaskbar   =   0   'False
   StartUpPosition =   3  'Windows の既定値
   Begin MSComDlg.CommonDialog CommonDialog1 
      Left            =   5640
      Top             =   7920
      _ExtentX        =   847
      _ExtentY        =   847
      _Version        =   393216
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   14
      Left            =   8040
      TabIndex        =   16
      Top             =   6480
      Width           =   3735
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   13
      Left            =   8040
      TabIndex        =   15
      Top             =   5160
      Width           =   3735
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   12
      Left            =   8040
      TabIndex        =   14
      Top             =   3720
      Width           =   3735
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   11
      Left            =   8040
      TabIndex        =   13
      Top             =   2280
      Width           =   3735
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   9
      Left            =   4080
      TabIndex        =   12
      Top             =   6480
      Width           =   3735
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   10
      Left            =   8040
      TabIndex        =   11
      Top             =   840
      Width           =   3735
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   7
      Left            =   4080
      TabIndex        =   10
      Top             =   3720
      Width           =   3735
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   5
      Left            =   4080
      TabIndex        =   9
      Top             =   840
      Width           =   3735
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   8
      Left            =   4080
      TabIndex        =   8
      Top             =   5160
      Width           =   3735
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   2
      Left            =   120
      TabIndex        =   7
      Top             =   3720
      Width           =   3735
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   4
      Left            =   120
      TabIndex        =   6
      Top             =   6480
      Width           =   3735
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   1
      Left            =   120
      TabIndex        =   5
      Top             =   2280
      Width           =   3735
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   3
      Left            =   120
      TabIndex        =   4
      Top             =   5160
      Width           =   3735
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   6
      Left            =   4080
      TabIndex        =   3
      Top             =   2280
      Width           =   3735
   End
   Begin VB.CommandButton cmdExMasterInput 
      Caption         =   "○○○○○○○○○○○○"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   855
      Index           =   0
      Left            =   120
      TabIndex        =   2
      Top             =   840
      Width           =   3735
   End
   Begin VB.Timer tmrMail 
      Enabled         =   0   'False
      Interval        =   3000
      Left            =   5640
      Top             =   8520
   End
   Begin VB.CommandButton cmdReturn 
      Caption         =   "戻る"
      BeginProperty Font 
         Name            =   "ＭＳ Ｐゴシック"
         Size            =   12
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   1095
      Left            =   9720
      TabIndex        =   0
      Top             =   7800
      Width           =   2055
   End
   Begin VB.Label Label3 
      Alignment       =   2  '中央揃え
      BackColor       =   &H00800000&
      Caption         =   "外部マスタ入力"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   15.75
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00FFFFFF&
      Height          =   375
      Left            =   0
      TabIndex        =   1
      Top             =   0
      Width           =   12015
   End
End
Attribute VB_Name = "frmExMasterInput"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
'///////////////////////////////////////////////////////////////////
'//  (C) Copyright TOSHIBA Corporation 2014 ALL Rights Reserved
'//
'//  ファイル名  ：frmExMasterInput.frm
'//  パッケージ名：外部マスタ入力画面
'//
'//  概要：外部マスタ入力画面
'//     ORIGINAL  :(V30.1.0.1) 2014-02-24   CODED   BY [TCC] T.Nakajima
'//     REVISIONS :(EG20 V30.4.0.1) 2015-01-15 REVISED BY  [TCC] S.Kuroda
'//                 北陸新幹線フェーズ３対応【HKRK_kansi02_001_01】
'//     REVISIONS :(X.X.X.X) ----------   REVISED BY []
'//  備考：
'///////////////////////////////////////////////////////////////////
Option Explicit

Private Const MN_MAIL_INTERVAL = 1000                       'メールタイマのインターバル値
Private Const MASTER_INPUT_BTN_MAX = 15                     '最大マスタ入力釦数

Private Type EXMASTER_INI
    sMasterFilter               As String                   'マスタファイル名（ワイルドカード）
    sExtMasterName              As String                   '釦名称
    bBtnEnabled                 As Boolean                  '釦Enabledプロパティ
    dwDataKind                  As Long                     'データ種別
    sDstFileName                As String                   'コピー先ファイル名
End Type
Private ExMstIni(0 To 14)       As EXMASTER_INI             '外部マスタ入力画面用INIファイル格納エリア
Private Const INI_LINE_MAX = 255                            'DSPX=の最大文字数

Private Enum mintBtnIdx                                     '釦インデックスとその名称
    BTN_IDX_IUZ = 0             'ICカード運用マスタ
    BTN_IDX_KSZ                 '改札機過渡期制限マスタ
    BTN_IDX_IUK = 5             '新幹線ICカード運用マスタ
    BTN_IDX_SWK                 '新幹線改札機スイッチマスタデータ
    BTN_IDX_DUS                 '改札機動作マスタ
    BTN_IDX_PNO                 '商品・割引コードデータ
    BTN_IDX_NHK                 '駅名マスタ
    BTN_IDX_KEN                 '券止めマスタ
    BTN_IDX_STP                 '券通しマスタ
    BTN_IDX_FRC                 'フリーコードマスタ
End Enum

Private iHyoujiCnt              As Integer                  '表示カウンター
Private gintBtnIdx              As Integer                  '押下された釦のインデックス

'///////////////////////////////////////////////////////////////////
'//  (C) Copyright TOSHIBA Corporation 2014 All Rights Reserved
'//
'//  関数名称  : Form_Activate
'//  機能名称  : 外部マスタ入力画面(アクティブ時)
'//  機能概要  : メール受信用タイマを起動
'//
'//              型        名称      意味
'//  引数      : なし
'//
'//              型        値        意味
'//  戻り値    : なし
'//
'//     ORIGINAL  :(V30.1.0.1) 2014-02-24   CODED   BY [TCC] T.Nakajima
'//     REVISIONS :(X.X.X.X) ----------   REVISED BY []
'//  備考：
'///////////////////////////////////////////////////////////////////
Private Sub Form_Activate()
On Error Resume Next
    'メール受信用タイマを起動する
    tmrMail.Enabled = True
End Sub

'///////////////////////////////////////////////////////////////////
'//  (C) Copyright TOSHIBA Corporation 2014 All Rights Reserved
'//
'//  関数名称  : Form_Deactivate
'//  機能名称  : 外部マスタ入力画面(ディアクティブ時)
'//  機能概要  : メール受信用タイマを停止
'//
'//              型        名称      意味
'//  引数      : なし
'//
'//              型        値        意味
'//  戻り値    : なし
'//
'//     ORIGINAL  :(V30.1.0.1) 2014-02-24   CODED   BY [TCC] T.Nakajima
'//     REVISIONS :(X.X.X.X) ----------   REVISED BY []
'//  備考：
'///////////////////////////////////////////////////////////////////
Private Sub Form_Deactivate()
On Error Resume Next
    'メール受信用タイマを止める
    tmrMail.Enabled = False
End Sub

'///////////////////////////////////////////////////////////////////
'//  (C) Copyright TOSHIBA Corporation 2014 All Rights Reserved
'//
'//  関数名称  : Form_Load
'//  機能名称  : 外部マスタ入力画面(ロード時)
'//  機能概要  : 初期処理を行う。
'//
'//              型        名称      意味
'//  引数      : なし
'//
'//              型        値        意味
'//  戻り値    : なし
'//
'//     ORIGINAL  :(V30.1.0.1) 2014-02-24   CODED   BY [TCC] T.Nakajima
'//     REVISIONS :(X.X.X.X) ----------   REVISED BY []
'//  備考：
'///////////////////////////////////////////////////////////////////
Private Sub Form_Load()
    Dim i As Integer    'カウンター
    
On Error Resume Next
   
   '「外部マスタ入力画面：表示」ログ出力
   Call sLogTraceReq(LTYP_NORMAL, L3AN_ETC, EXTMST_GAMEN_START, 0)
    
    Me.Top = 0
    Me.Left = 0
    Me.Height = 9000
    Me.Width = 12000
    
    '初期化
    iHyoujiCnt = 0    '表示カウンター
    
    For i = 0 To MASTER_INPUT_BTN_MAX - 1
        '釦表示文言初期化
        ExMstIni(i).sExtMasterName = ""
    Next
    For i = 0 To MASTER_INPUT_BTN_MAX - 1
        '外部マスタファイル名エリア初期化
        ExMstIni(i).sMasterFilter = ""
    Next
     
    'メール受信用のタイマ値を設定する。
    tmrMail.Interval = MN_MAIL_INTERVAL
    tmrMail.Enabled = False
    
    '画面タイトルを設定する。
    If gintCornerType(gintSelectedCornerTabIdx) = CORNER_TYPE_ZAIRAI Then
        Label3.Caption = "外部マスタ入力（在来線）"
    Else
        Label3.Caption = "外部マスタ入力（幹線）"
    End If
    
    '固定釦表示初期処理
    sFixedExeDisplay
End Sub

'///////////////////////////////////////////////////////////////////
'//  (C) Copyright TOSHIBA Corporation 2014 All Rights Reserved
'//
'//  関数名称  : cmdExMasterInput_Click
'//  機能名称  : 「外部マスタ入力」釦押下時処理
'//  機能概要  : 外部マスタをインストールする。
'//
'//              型        名称      意味
'//  引数      : なし
'//
'//              型        値        意味
'//  戻り値    : なし
'//
'//     ORIGINAL  :(EG20 V30.1.0.1) 2014-02-24   CODED   BY [TCC] T.Nakajima
'//     REVISIONS :(EG20 V30.0.3.1) 2014-10-21   REVISED BY [TCC] T.Nakajima
'//                 北陸新幹線フェーズ２対応
'//     REVISIONS :(EG20 V30.4.0.1) 2015-01-15   REVISED BY [TCC] S.Kuroda
'//                 北陸新幹線フェーズ３対応【HKRK_kansi02_001_01】
'//     REVISIONS :(X.X.X.X) ----------   REVISED BY []
'//  備考：
'///////////////////////////////////////////////////////////////////
Private Sub cmdExMasterInput_Click(Index As Integer)

    Dim iResponse   As Integer                  'メッセージ応答結果
    Dim strToPath   As String                   'コピー先ファイルパス
    Dim lngErrCode  As Long                     'エラーコード
    Dim objFso      As New FileSystemObject     'ファイルシステムオブジェクト
    Dim strFilter   As String                   'コモンダイアログのフィルタリング文字列
    
    Dim szInputPath As String                   ' コピー元フォルダパス
    
    Dim strFileName As String                   'コピー元ファイル名（拡張子除く）
    Dim strExtName  As String                   'コピー元拡張子
    
    On Error Resume Next
    
    '「外部マスタ入力画面：外部マスタ釦押下」ログ出力
    Call sLogTraceReq(LTYP_NORMAL, L3AN_ETC, EXTMST_GAMEN_MSTINPUT_BUTTOM, 0)
    
    '押下された釦のインデックスを保持
    gintBtnIdx = Index
    
    iResponse = MsgBox(ExMstIni(gintBtnIdx).sExtMasterName & "を入力します。" & vbCrLf & "よろしいですか？", _
                        vbOKCancel + vbQuestion, "外部マスタデータ入力確認")
    
    If iResponse = vbCancel Then
        Exit Sub
    End If
    
    '取得ファイル名を初期化
    CommonDialog1.FileName = ""
    
    '初期ディレクトリを設定
    If objFso.FolderExists(SHOWFILE_DEFAULTFOLDER1) = True Then    'フォルダ選択画面デフォルトパス１が存在するか
        '存在するため、デフォルトパス１（H:）を設定
        CommonDialog1.InitDir = SHOWFILE_DEFAULTFOLDER1
    Else
        '存在しないため、デフォルトパス２（C:）を設定
        CommonDialog1.InitDir = SHOWFILE_DEFAULTFOLDER2
    End If
    
    '表示ファイルをフィルタリング
    strFilter = ExMstIni(Index).sExtMasterName & "|" & ExMstIni(Index).sMasterFilter & "|"
    CommonDialog1.Filter = strFilter
    
    'ファイル選択画面を開く
    CommonDialog1.ShowOpen
    '選択したファイル名を取得
    szInputPath = CommonDialog1.FileName
    If szInputPath = "" Then 'ファイル未選択
        Set objFso = Nothing
        Exit Sub    'ファイルが選択されなければ処理中断
    End If
    
    If objFso.FileExists(szInputPath) = False Then
        ' コピー元にマスタファイルが存在しない場合は異常
        Call MsgBox(ExMstIni(gintBtnIdx).sExtMasterName & "の入力に失敗しました", vbOKOnly + vbCritical, "外部マスタデータ入力結果")
        Set objFso = Nothing
        Exit Sub
    End If
    
    '画面をロックする
    Call sSetEnable(False)
    
    On Error GoTo Err_Handler
    
    strToPath = PATH_KANSI & "DESHU" & Format(gintSelectedCornerTabIdx + 1, "00") & DIR_MASTER_V
    
    'コピー先フォルダの有無確認
    If objFso.FolderExists(strToPath) = False Then
        'コピー先フォルダ作成
        objFso.CreateFolder (strToPath)
    End If
    'コピー先ファイル名を設定し、ファイルコピー
    strToPath = strToPath & ExMstIni(gintBtnIdx).sDstFileName
' EG20 V30.4.0.1【HKRK_kansi02_001_01】 DEL Start
'    objFso.CopyFile szInputPath, strToPath, True
' EG20 V30.4.0.1【HKRK_kansi02_001_01】 DEL End
' EG20 V30.4.0.1【HKRK_kansi02_001_01】 ADD Start
    '一時保存フォルダにデータをコピーし読取専用を解除する
    If pfChangeAttrNormal(szInputPath, PATH_HOSHUTMP_MST_DATA, strToPath) = False Then
        '異常処理へ
        GoTo Err_Handler
    End If
' EG20 V30.4.0.1【HKRK_kansi02_001_01】 ADD End
    'EG20 V30.0.3.1 ADD START
    'ChDirではCommonDialogの場合、Hドライブが選択されたまま変更されず、媒体取外しができなくなるため、ChDriveに変更
    ChDrive "C"
    'EG20 V30.0.3.1 ADD END
    ChDir$ "C:\"
    '
    Set objFso = Nothing
    
    On Error Resume Next
    
    iResponse = MsgBox(ExMstIni(gintBtnIdx).sExtMasterName & "を適用します。" & vbCrLf & "よろしいですか？", _
                        vbOKCancel + vbQuestion, "外部マスタデータ適用確認")
    
    If iResponse = vbCancel Then
        Call sSetEnable(True)
        Exit Sub
    End If
    
    'プログレスバーを表示する
    Call SendMessageProgress(ML_ID_PRGBAR_SHOW_REQ, PRG_HOSHUKINOU)
    
    'マスタ更新要求送信
    If fCDATAMailSend(Index) = False Then
        'プログレスバーを消去する
        Call SendMessageProgress(ML_ID_PRGBAR_HIDE_REQ)

        iResponse = MsgBox(ExMstIni(gintBtnIdx).sExtMasterName & "の入力に失敗しました", vbOKOnly + vbCritical, "外部マスタ入力結果")
        Call sSetEnable(True)
        Exit Sub
    End If
    
    '受信待ち。
    
    Exit Sub

Err_Handler:
    Set objFso = Nothing
' EG20 V30.4.0.1【HKRK_kansi02_001_01】 ADD Start
    '一時保存フォルダを削除する
    psDeleteFolder PATH_HOSHUTMP
' EG20 V30.4.0.1【HKRK_kansi02_001_01】 ADD End
    Call sSetEnable(True)
    '「マスタ入力画面：マスタデータ入力異常」ログ出力
    lngErrCode = EDAI_KANSHI + ECHU_HOSHU + ESHO_FILE_IO + ECOD_FWRITE
    Call sLogTraceReq(LTYP_NORMAL, L3AN_ETC, EXTMST_GAMEN_INPUT_ERROR, lngErrCode)

    'プログレスバーを消去する
    Call SendMessageProgress(ML_ID_PRGBAR_HIDE_REQ)
    
    iResponse = MsgBox(ExMstIni(gintBtnIdx).sExtMasterName & "の入力に失敗しました", vbOKOnly + vbCritical, "外部マスタデータ入力結果")
    
End Sub


'///////////////////////////////////////////////////////////////////
'//  (C) Copyright TOSHIBA Corporation 2014 All Rights Reserved
'//
'//  関数名称  : cmdReturn_Click
'//  機能名称  : 「戻る」釦押下時処理
'//  機能概要  : 自画面を消去する。
'//
'//              型        名称      意味
'//  引数      : なし
'//
'//              型        値        意味
'//  戻り値    : なし
'//
'//     ORIGINAL  :(V30.1.0.1) 2014-02-24   CODED   BY [TCC] T.Nakajima
'//     REVISIONS :(X.X.X.X) ----------   REVISED BY []
'//  備考：
'///////////////////////////////////////////////////////////////////
Private Sub cmdReturn_Click()
   On Error Resume Next
   '「外部マスタ入力画面：消去」ログ出力
   Call sLogTraceReq(LTYP_NORMAL, L3AN_ETC, EXTMST_GAMEN_END, 0)
   Unload Me
End Sub

'///////////////////////////////////////////////////////////////////
'//  (C) Copyright TOSHIBA Corporation 2014 All Rights Reserved
'//
'//  関数名称  : sExtMstBtnDisplay
'//  機能名称  : 外部マスタ入力釦初期表示処理
'//  機能概要  : 初期表示処理を行う。
'//
'//              型        名称      意味
'//  引数      : なし
'//
'//              型        値        意味
'//  戻り値    : なし
'//
'//     ORIGINAL  :(V30.1.0.1) 2014-02-24   CODED   BY [TCC] T.Nakajima
'//     REVISIONS :(X.X.X.X) ----------   REVISED BY []
'//  備考：
'///////////////////////////////////////////////////////////////////
Private Sub sFixedExeDisplay()
    Dim i As Integer                                'INIﾌｧｲﾙキーカウンタ：DSPi ＝起動釦INDEX
    Dim iMax            As Integer                  '固定起動釦INDEX最大値
    Dim sLine           As String * INI_LINE_MAX    'INIファイル１行文の文字列。（文字列”DSPi=”を除く）
    Dim lSize           As Long                     '１行文のﾊﾞｲﾄ数。（文字列”DSPi=”を除く）
'    Dim iK              As Integer                  'カンマ記述位置
    Dim iMozi           As Integer                  'カンマ検索位置
    Dim iKbn            As Integer                  '１：釦表示名称     ２：フィルタリングファイル名
    Dim strTempSection  As String                   'INIのセクション名（在来用/幹線用）
    
    On Error Resume Next
    
    iMax = cmdExMasterInput.UBound     '外部マスタ入力釦INDEXの最大値を得る。
    
    '現在のコーナは在来か？幹線か？
    If gintCornerType(gintSelectedCornerTabIdx) = CORNER_TYPE_ZAIRAI Then
        '在来コーナの場合のセクション名をセット
        strTempSection = PROFILE_SECTION_NAME_ZAIRAI
    Else
        '幹線コーナの場合のセクション名をセット
        strTempSection = PROFILE_SECTION_NAME_KANSEN
    End If
    
    For i = 0 To MASTER_INPUT_BTN_MAX - 1
       '外部マスタ入力画面用INIファイルから、１行文の文字列（DSPi=を除く）を読込む。
        lSize = GetPrivateProfileString(strTempSection, _
                                        PROFILE_KEY_NAME_MST_INP & CStr(i), _
                                        DEFAILT, sLine, Len(sLine), EXT_MASTER_INP_FILE)
        
        iMozi = 1
        iKbn = 1
        Do
           'モジュール情報格納エリアに1行分のデータを保持させる。
            If Mid(sLine, iMozi, 1) = "," Or Mid(sLine, iMozi, 1) = vbNullChar Then
                Select Case iKbn
                    Case 1      '釦表示名称を取得
                        ExMstIni(i).sExtMasterName = Left(sLine, iMozi - 1)
                        sLine = Mid(sLine, iMozi + 1)
                        iMozi = 0
                        iKbn = iKbn + 1
                    Case 2      'フィルタリングファイル名を取得
                        ExMstIni(i).sMasterFilter = Left(sLine, iMozi - 1)
                        sLine = Mid(sLine, iMozi + 1)
                        iMozi = 0
                        iKbn = iKbn + 1
                    Case 3      '釦enabledプロパティを取得
                        If Left(sLine, iMozi - 1) = "True" Then
                            ExMstIni(i).bBtnEnabled = True
                        Else
                            ExMstIni(i).bBtnEnabled = False
                        End If
                        sLine = Mid(sLine, iMozi + 1)
                        iMozi = 0
                        iKbn = iKbn + 1
                    Case 4      'データ種別を取得
                        ExMstIni(i).dwDataKind = CLng(Left(sLine, iMozi - 1))
                        sLine = Mid(sLine, iMozi + 1)
                        iMozi = 0
                        iKbn = iKbn + 1
                    Case 5      'コピー先ファイル名を取得
                        ExMstIni(i).sDstFileName = Left(sLine, iMozi - 1)
                        sLine = Mid(sLine, iMozi + 1)
                        iMozi = 0
                        iKbn = iKbn + 1
                End Select
            End If
            iMozi = iMozi + 1
            If iMozi > Len(sLine) Then
                Exit Do
            End If
        Loop
        
'        iK = InStr(sLine, ",")        'ファイル名（フルパス）の区切文字位置を得る。
'        'INIファイルに、該当行の定義がある場合、
'        If lSize > 0 And iK <> 0 Then
'         '釦名称とフィルタリングするファイル名を取出し、保存しておく。
'          ExMstIni.sExtMasterName(i) = Trim$(Left$(sLine, iK - 1))
'          ExMstIni.sMasterFilter(i) = Trim$(Mid$(sLine, iK + 1, lSize - iK))
'        End If
    Next i
    
    
    '全ての固定起動釦について、以下を実施する。
    For i = 0 To iMax
       '外部マスタ入力釦を非表示にする。
        cmdExMasterInput(i).Visible = False
        '表示釦名称と外部マスタファイル名の定義チェックを行う。
        If ExMstIni(i).sExtMasterName <> "" And ExMstIni(i).sMasterFilter <> "" Then
            '定義有りの場合、キャプションに起動釦表示文字列を書込み、起動釦を表示する。
            cmdExMasterInput(i).Visible = True
            cmdExMasterInput(i).Caption = ExMstIni(i).sExtMasterName
            'iniファイルから取得した、釦enabledプロパティを設定
            cmdExMasterInput(i).Enabled = ExMstIni(i).bBtnEnabled
        End If
        '表示カウンタアップする。
        iHyoujiCnt = iHyoujiCnt + 1
    Next i
     
End Sub


'///////////////////////////////////////////////////////////////////
'//  (C) Copyright TOSHIBA Corporation 2014 All Rights Reserved
'//
'//  関数名称  : tmrMail_Timer
'//  機能名称  : メール受信タイマ、タイムアップ処理
'//  機能概要  : メールを受信する。
'//
'//              型        名称      意味
'//  引数      : なし
'//
'//              型        値        意味
'//  戻り値    : なし
'//
'//     ORIGINAL  :(V30.1.0.1) 2014-02-24   CODED   BY [TCC] T.Nakajima
'//     REVISIONS :(X.X.X.X) ----------   REVISED BY []
'//  備考：
'///////////////////////////////////////////////////////////////////
Private Sub tmrMail_Timer()
  
    Dim udtReadMail     As ML_KYOTU_INF     'メール受信エリア
    Dim lngLength       As Long             '受信メールバイトサイズ
    Dim intStatus       As Integer          '受信メールチェック結果
    Dim iResponse       As Integer
    
    On Error Resume Next
    
    'メールを受信する。
    lngLength = DssMailRead(plMSlot_MN, udtReadMail)
    If lngLength > 0 Then
    '受信メールがあれば、メールＩＤ毎の処理をする。
        Select Case udtReadMail.udtlHeader.dwId        'メールＩＤ
            Case ML_ID_PROEND_ORD
                '「プロセス終了指示」を受信した場合、
                '「プロセス終了指示受信正常」ログ出力
                Call sLogTraceReq(LTYP_NORMAL, L3AN_RECV, PROCESS_END_ORD_RECV, 0)
                'プロセスの終了処理を行う
                pfAbortProc
            Case ML_ID_HOSHU_ACTIVE_REQ
                '「保守画面アクティブ表示」を受信した場合
                '「保守画面アクティブ表示要求受信正常」ログ出力
                Call sLogTraceReq(LTYP_NORMAL, L3AN_RECV, HOSHU_ACTIVE_REQ_RECV, 0)
                '表示元画面（保守データ収集画面）をアクティブ表示する。
                AppActivate frmExMasterInput.Caption, False
                pfFormActive (frmExMasterInput.hwnd)
            Case ML_ID_MASTER_UPDATE_RES
                'プログレスバーを消去する
                Call SendMessageProgress(ML_ID_PRGBAR_HIDE_REQ)
                
                '「マスタ更新完了通知」を受信した場合
                If fReadMailCheck(udtReadMail, gintBtnIdx) = False Then
                    iResponse = MsgBox(ExMstIni(gintBtnIdx).sExtMasterName & "の入力に失敗しました", vbOKOnly + vbCritical, "外部マスタデータ入力結果")
                Else
                    iResponse = MsgBox(ExMstIni(gintBtnIdx).sExtMasterName & "を正常に入力しました", vbOKOnly + vbInformation, "外部マスタデータ入力結果")
                End If
                Call sSetEnable(True)
            Case Else
                 'その他のメールを受信した場合
                 '「メールID不正」ログ出力
                 Call sLogTraceReq(LTYP_ERROR, L3AN_RECV, MAIL_FUSEI_RECV, 0)
        End Select
    End If
  
End Sub

'///////////////////////////////////////////////////////////////////
'//  (C) Copyright TOSHIBA Corporation 2014 All Rights Reserved
'//
'//  関数名称  : sSetEnable
'//  機能名称  : 活性状態制御
'//  機能概要  : コマンドボタンの活性・非活性を制御する
'//
'//              型        名称      意味
'//  引数      : Boolean   blnEnable [IN]活性／不活性フラグ
'//
'//              型        値        意味
'//  戻り値    : なし
'//
'//     ORIGINAL  :(EG20 V30.1.0.1) 2014-02-24   CODED   BY [TCC] T.Nakajima
'//     REVISIONS :(X.X.X.X) ----------   REVISED BY []
'//  備考：
'///////////////////////////////////////////////////////////////////
Private Sub sSetEnable(ByVal blnEnable As Boolean)

    Dim i       As Integer
    
    On Error Resume Next
    
    For i = 0 To cmdExMasterInput.UBound
        'blnEnableがtrueで渡されてきたときはiniファイルの設定を優先する。
        If blnEnable = True Then
            cmdExMasterInput(i).Enabled = ExMstIni(i).bBtnEnabled
        Else    'blnEnableがfaleの時はすべての釦をfalseにする
            cmdExMasterInput(i).Enabled = blnEnable
        End If
    Next i
    
    cmdReturn.Enabled = blnEnable
End Sub

'///////////////////////////////////////////////////////////////////
'//  (C) Copyright TOSHIBA Corporation 2014 All Rights Reserved
'//
'//  関数名称  : fCDATAMailSend
'//  機能名称  : マスタ更新要求送信処理
'//  機能概要  : 初期処理時：メールを送信する。
'//
'//              型        名称      意味
'//  引数      : Integer   [IN]iBtnIdx 押下された釦インデックス
'//
'//              型        値        意味
'//  戻り値    : Boolean　　　　　　[OUT]戻り値
'//
'//     ORIGINAL  :(EG20 V30.1.0.1) 2014-02-25   CODED   BY [TCC] T.Nakajima
'//  備考：
'///////////////////////////////////////////////////////////////////
Private Function fCDATAMailSend(iBtnIdx As Integer) As Boolean

    Dim udtMail As MAIL_INFO_RES    'マスタ更新要求メール送信エリア
    Dim lngRet As Long              '関数戻り値
    Dim lngErrCode As Long          'エラーコード
    
    On Error Resume Next
 
    'マスタ更新要求を監マに送信する。
    udtMail.mlHeader.dwId = ML_ID_MASTER_UPDATE_CMD
    udtMail.mlHeader.dwSize = MlSize.MASTER_UPDATE_REQ
    udtMail.mlHeader.dwProid = RHOSHU_ID
    udtMail.mlHeader.dwSubArea = 0
    
    '押下された釦によりデータ種別を選択
    udtMail.dwRequestType = ExMstIni(iBtnIdx).dwDataKind
    udtMail.dwSts = gintSelectedCornerTabIdx + 1
    
    lngRet = DssSendMail(MAIL_SLOT_KANMA, Len(udtMail), udtMail.mlHeader)
    If lngRet = False Then
       '「マスタデータ入力画面：マスタ更新要求送信異常」ログ出力
       lngErrCode = EDAI_KANSHI + ECHU_HOSHU + ESHO_MAIL_IO + ECOD_MSEND
       Call sLogTraceReq(LTYP_ERROR, L3AN_SEND, MASTER_UPDATE_REQ_SEND, lngErrCode)
       fCDATAMailSend = False
       Exit Function
    Else
       '「マスタデータ入力画面：マスタ更新要求送信正常」ログ出力
       Call sLogTraceReq(LTYP_NORMAL, L3AN_SEND, MASTER_UPDATE_REQ_SEND, 0)
       fCDATAMailSend = True
    End If
    
End Function

'///////////////////////////////////////////////////////////////////
'//  (C) Copyright TOSHIBA Corporation 2014 All Rights Reserved
'//
'//  関数名称  : fReadMailCheck
'//  機能名称  : マスタ更新完了通知メールチェック処理
'//  機能概要  : メール受信時：メールを受信する。
'//
'//              型        名称      意味
'//  引数      : ML_KYOTU_INF        メール受信エリア
'//              Integer   iBtnIdx   現在選択中のマスタ名称インデックス
'//
'//              型        値        意味
'//  戻り値    : Boolean　　　　　　[OUT]戻り値
'//
'//     ORIGINAL  :(EG20 V30.1.0.1) 2014-02-26   CODED   BY [TCC] T.Nakajima
'//     REVISIONS :(X.X.X.X) ----------   REVISED BY []
'//  備考：
'///////////////////////////////////////////////////////////////////
Private Function fReadMailCheck(udtReadMail As ML_KYOTU_INF, iBtnIdx As Integer) As Boolean

    Dim lngErrCode  As Long
    
    On Error Resume Next
    
    'データ種別チェック
    If udtReadMail.lngData(0) <> ExMstIni(iBtnIdx).dwDataKind Then
        lngErrCode = EDAI_KANSHI + ECHU_HOSHU + ESHO_MAIL_IO + ECOD_MRECEIVE + 1
        Call sLogTraceReq(LTYP_ERROR, L3AN_RECV, MASTER_UPDATE_REQ_RECV, lngErrCode)
        fReadMailCheck = False
        Exit Function
    End If
    
    'コーナチェック
    If udtReadMail.lngData(1) <> (gintSelectedCornerTabIdx + 1) Then
        lngErrCode = EDAI_KANSHI + ECHU_HOSHU + ESHO_MAIL_IO + ECOD_MRECEIVE + 2
        Call sLogTraceReq(LTYP_ERROR, L3AN_RECV, MASTER_UPDATE_REQ_RECV, lngErrCode)
        fReadMailCheck = False
        Exit Function
    End If
    
    '処理結果チェック
    If udtReadMail.lngData(2) > 0 Then
        fReadMailCheck = False
        Exit Function
    End If
    
    fReadMailCheck = True
    
End Function

